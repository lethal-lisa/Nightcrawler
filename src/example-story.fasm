; Nightcrawler Example Story File
; Assemble with fasm

; Header:
db 'NST', 00h ; Magic.
dd 00000000h  ; NST format version.
dd gameTitle  ; Title string addr.
dd promptStr  ; Prompt string addr.
dd helpStr    ; Help string addr.
dw 1          ; Count of item names.
dd itemNames  ; Item name addr.
dd initScene  ; Initial scene addr.

gameTitle:    ; Game title string.
db 'Example Nightcrawler Story File', 10
db '(c)2022 Lisa-Annette Murray, part of the Nightcrawler codebase.', 10, 00h

promptStr:    ; Prompt string.
db 'N> ', 0

helpStr:      ; Help string.
db 'Nightcrawler Example Story File', 10
db '(c)2022 Lisa-Annette Murray', 10
db 'This story file contains two scenes used to debug the Nightcrawler engine.', 10, 00h

itemNames:    ; Item name list.
db 'Door key', 00h

; ----------------------------------------------------------------------------
; Initial Scene Node
; ----------------------------------------------------------------------------

initScene:         ; Initial scene node.
db 'NSC', 00h      ; Scene node header.
dd .initScene_Move ; Move cluster address.
dd .initScene_Look ; Look cluster address.
dw 0001h           ; GET item mask.
dd 0               ; TALK cluster address.
dd .initScene_Use  ; Use cluster offset.

.initScene_Move:
db 'MOV', 00h    ; Magic.
dw 0001h         ; Required story flags for alt addresses.
dw 0000h         ; Required item flags for alt addresses.
dd 0             ; North.
dd hallS         ; South.
dd 0             ; East.
dd 0             ; West.
dd sceneMainRoom ; Alt North.
dd 0             ; Alt South.
dd 0             ; Alt East.
dd 0             ; Alt West.

.initScene_Look:
db 'LOK', 00h                ; Magic.
dw 0000h                     ; Story flags to set.
dw 0001h                     ; Required story flags for alt text.
dw 0000h                     ; Required item flags for alt text.
dd .initScene_LookAroundC    ; Around.
dd .initScene_LookClosedDoor ; North.
dd .initScene_LookHallS      ; South.
dd .initScene_LookWall       ; East.
dd .initScene_LookWall       ; West.
dd .initScene_LookAroundO    ; Around alt.
dd .initScene_LookOpenDoor   ; North alt.
dd 0                         ; South alt.
dd 0                         ; East alt.
dd 0                         ; West alt.

.initScene_LookAroundO:
db 'The door at the end of the hall is open now, and bright light fills the', 10
db 'empty passage.', 00h
.initScene_LookAroundC:
db 'You find yourself standing in an empty hallway with an closed door at the', 10
db 'North end. The hallway is dimly lit and a bright light pours from', 10
db 'underneath the doorway. Looking around there are no other exits.', 00h
.initScene_LookClosedDoor:
db 'There is a closed and locked door at the end of the hallway. There is a', 10
db 'key on the floor next to the door.', 00h
.initScene_LookOpenDoor:
db 'Beyond the now open door is a blinding light.', 00h
.initScene_LookWall:
db 'There is nothing but the wall with a faint tiled pattern.', 00h
.initScene_LookHallS:
db 'The hall extends in this direction.', 00h

.initScene_Use:
db 'USE', 00h ; Magic.
dw 0001h      ; Story flags to set.
dw 0000h      ; Item flags to set.
dw 0000h      ; Required story flags.
dw 0001h      ; Required item flags.
dd .iS_UseKey ; Addr of string to print.

.iS_UseKey:
db 'You insert the key into the door and turn. With a click the door opens.', 00h

; ----------------------------------------------------------------------------
; Hall South
; ----------------------------------------------------------------------------

hallS:         ; South hall
db 'NSC', 00h  ; Scene node header.
dd .hallS_Move ; Move cluster address.
dd .hallS_Look ; Look cluster address.
dw 0001h       ; GET item mask.
dd 0           ; TALK cluster address.
dd 0           ; Use cluster offset.

.hallS_Move:
db 'MOV', 00h ; Magic.
dw 0002h      ; Required story flags for alt addresses.
dw 0000h      ; Required item flags for alt addresses.
dd initScene  ; North.
dd 0          ; South.
dd 0          ; East.
dd 0          ; West.
dd 0          ; Alt North.
dd winNode1   ; Alt South.
dd 0          ; Alt East.
dd 0          ; Alt West.

.hallS_Look:
db 'LOK', 00h           ; Magic.
dw 0000h                ; Story flags to set.
dw 0002h                ; Required story flags for alt text.
dw 0000h                ; Required item flags for alt text.
dd .hallS_LookAroundC   ; Around.
dd .hallS_LookN         ; North.
dd .hallS_LookCloseDoor ; South.
dd initScene.initScene_LookWall  ; East.
dd initScene.initScene_LookWall  ; West.
dd .hallS_LookAroundO   ; Around alt.
dd 0                    ; North alt.
dd .hallS_LookOpenDoor  ; South alt.
dd 0                    ; East alt.
dd 0                    ; West alt.

.hallS_LookAroundC:
db 'You are at the end of the hall, it is dark and the walls are cold to the', 10
db 'touch. The South wall looks like it could move.', 00h
.hallS_LookN:
db 'The North end of the hallway expands before you.', 00h
.hallS_LookCloseDoor:
db 'Looking closer at the South wall it seems like it is hollow. You can hear', 10
db 'mechanical parts moving behind it. You are now certain it could move, but', 10
db 'there is no visible mechanism for this, only an insignia of a bear to the', 10
db 'side.', 00h
.hallS_LookAroundO:
db 'The South end of the hall is now brightly lit after the bear opened the', 10
db 'door. The walls are warm and sun pours in from outside.', 00h
.hallS_LookOpenDoor:
db 'The wall that was here before has been retracted into the floor, allowing', 10
db 'you to pass. Beyond the now open portal extends the great outdoors.', 00h

; ----------------------------------------------------------------------------
; Win Node
; ----------------------------------------------------------------------------

winNode1:
db 'WIN', 00h
dd .winStr

.winStr:
db 10, 10
db 'Congratulations on completing this example story. You have now experienced', 10
db 'most of the features of the Nightcrawler engine.', 10, 10
db 'Thank you for playing.', 10
db '(c)2022 Lisa-Annette Murray, dedicated to Chloii, my partner.', 00h

; ----------------------------------------------------------------------------
; Death Node
; ----------------------------------------------------------------------------

deathNode1:
db 'DTH', 00h
dd .deathStr

.deathStr:
db 10, 10
db 'You spontaneously explode after trying to use the key on the teddy bear.', 10
db 10
db 'GAME OVER', 10, 10, 00h

; ----------------------------------------------------------------------------
; Main Room Node
; ----------------------------------------------------------------------------

sceneMainRoom:
db 'NSC', 00h     ; Magic.
dd .mainRoom_Move ; MOVE cluster.
dd .mainRoom_Look ; LOOK cluster.
dw 0000h          ; GET item mask.
dd .mainRoom_Talk ; TALK cluster
dd deathNode1     ; USE cluster.

.mainRoom_Move:
db 'MOV', 00h ; Magic.
dw 0000h      ; Required story flags for alt addresses.
dw 0000h      ; Required item flags for alt addresses.
dd 0          ; North.
dd initScene  ; South.
dd 0          ; East.
dd 0          ; West.
dd 0          ; Alt North.
dd 0          ; Alt South.
dd 0          ; Alt East.
dd 0          ; Alt West.

.mainRoom_Look:
db 'LOK', 00h           ; Magic.
dw 0000h                ; Story flags to set.
dw 0000h                ; Required story flags for alt text.
dw 0000h                ; Required item flags for alt text.
dd .mainRoom_LookAround ; Around.
dd .mainRoom_LookWall   ; North.
dd .mainRoom_LookBack   ; South.
dd .mainRoom_LookWall   ; East.
dd .mainRoom_LookWall   ; West.
dd 0                    ; Around alt.
dd 0                    ; North alt.
dd 0                    ; South alt.
dd 0                    ; East alt.
dd 0                    ; West alt.

.mainRoom_LookAround:
db 'A massive room swells around you; its expanse towering 12 feet all around', 10
db 'you. In the center is a plain dummy in the shape of a teddy bear mounted', 10
db 'to the floor.', 00h
.mainRoom_LookWall:
db 'To this side there is only a large tiled wall filling your vision.', 00h
.mainRoom_LookBack:
db 'Breaking up the tiled walls is the door to the small passage you entered', 10
db 'from.', 00h

.mainRoom_Talk:
db 'TLK', 00h     ; Magic.
dw 0000h          ; Required story flags.
dw 0000h          ; Required item flags.
dd teddyInitDia   ; Initial DIA node addr.

; ----------------------------------------------------------------------------
; Teddy Bear Dialogue Nodes
; ----------------------------------------------------------------------------

teddyInitDia:
db 'DIA', 00h     ; Magic.
dw 0001h          ; Story flags to set.
dw 0000h          ; Item flags to set.
dw 0000h          ; Alt story flags to set.
dw 0000h          ; Alt item flags to set.
dw 0000h          ; Required story flags for alt text & flags.
dw 0002h          ; Required item flags for alt text & flags.
dd .teddyInitText ; String to print.
dd .tedThankTxt   ; Alt string to print.
dd .teddyOptList1 ; Opt node list addr.

.teddyOptList1:
db 'DOL', 00h ; Magic.
dw 1          ; Count of option node addrs.
dd .tedOptHug ; Option node addr.

.tedOptHug:
db 'OPT', 00h    ; Magic.
dw 0002h         ; Story flags to set.
dw 0000h         ; Item flags to set.
dw 0000h         ; Required story flags.
dw 0000h         ; Required item flags.
dd .tedOptHugTxt ; Text this should print out.
dd .tedDiaThank  ; DIA node this branches to.

.tedDiaThank:
db 'DIA', 00h ; Magic.
dw 0000h      ; Story flags to set.
dw 0000h      ; Item flags to set.
dw 0000h      ; Alt story flags to set.
dw 0000h      ; Alt item flags to set.
dw 0002h      ; Required story flags.
dw 0000h      ; Required item flags.
dd .tedThankTxt 
dd 0
dd 0


.teddyInitText:
db '"Hi, I', "'m a teddy bear!", '" the bear speaks with a squeak.', 00h
.tedOptHugTxt:
db 'Hug the teddy bear.', 00h
.tedThankTxt:
db '"Thank you very much!" the bear blushes and smiles.', 10
db '"I', "'", 'll open the door at the other end of the hall for you!"', 00h

; End-of-File
